<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Manipulation of Tree Node Objects &#8212; cogent3 2020.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="../../_static/require.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Estimating periodic signals" href="period_estimation.html" />
    <link rel="prev" title="Data Manipulation using Table" href="handling_tabular_data.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          cogent3</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../draw/index.html">Image Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general.html">Posting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general.html#citation">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general.html#support">Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">Project History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycogent.html">How does <code class="docutils literal notranslate"><span class="pre">cogent3</span></code> relate to PyCogent?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects.html">Projects using <code class="docutils literal notranslate"><span class="pre">cogent3</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../licenses.html">License</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Manipulation of Tree Node Objects</a></li>
<li><a class="reference internal" href="#an-example-of-conditional-tree-node-modifications">An Example of Conditional Tree Node Modifications</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="handling_tabular_data.html" title="Previous Chapter: Data Manipulation using Table"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Data Manipula...</span>
    </a>
  </li>
  <li>
    <a href="period_estimation.html" title="Next Chapter: Estimating periodic signals"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Estimating pe... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="manipulation-of-tree-node-objects">
<h1>Manipulation of Tree Node Objects<a class="headerlink" href="#manipulation-of-tree-node-objects" title="Permalink to this headline">¶</a></h1>
<p><em>Section author: Tony Walters</em></p>
<p>Examples of how to initialize and manipulate various tree node objects.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cogent3.core.tree</span> <span class="kn">import</span> <span class="n">PhyloNode</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">make_tree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cogent3.parse.tree</span> <span class="kn">import</span> <span class="n">DndParser</span>
</pre></div>
</div>
<p>The general method to initialize a tree is <code class="docutils literal notranslate"><span class="pre">load_tree</span></code>, however, for exceptionally large trees or if one needs to specify the node objects (<code class="docutils literal notranslate"><span class="pre">TreeNode</span></code>, <code class="docutils literal notranslate"><span class="pre">PhyloNode</span></code>, or <code class="docutils literal notranslate"><span class="pre">RangeNode</span></code>), <code class="docutils literal notranslate"><span class="pre">DndParser</span></code> should be used.  <code class="docutils literal notranslate"><span class="pre">load_tree</span></code> uses <code class="docutils literal notranslate"><span class="pre">PhyloNode</span></code> objects by default.</p>
<p>The basic properties of the tree node objects are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TreeNode</span></code> objects are general purpose in nature, and lack phylogenetic distance values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PhyloNode</span></code> objects inherit the methods of the <code class="docutils literal notranslate"><span class="pre">TreeNode</span></code> class and in addition contain phylogenetic distances.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RangeNode</span></code> objects contain evolution simulation methods in addition to the standard features of a <code class="docutils literal notranslate"><span class="pre">PhyloNode</span></code>.</p></li>
</ul>
<p>The following demonstrates the two methods for initializing a phylogenetic tree object.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_tree_string</span><span class="o">=</span><span class="s2">&quot;(B:0.2,(C:0.3,D:0.4)E:0.5)F;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">complex_tree_string</span><span class="o">=</span><span class="s2">&quot;(((363564 AB294167.1 Alkalibacterium putridalgicola:0.0028006,55874 AB083411.1 Marinilactibacillus psychrotolerans:0.0022089):0.40998,(15050 Y10772.1 Facklamia hominis:0.32304,(132509 AY707780.1 Aerococcus viridans:0.58815,((143063 AY879307.1 Abiotrophia defectiva:0.5807,83619 AB042060.1 Bacillus schlegelii:0.23569):0.03586,169722 AB275483.1 Fibrobacter succinogenes:0.38272):0.06516):0.03492):0.14265):0.63594,(3589 M62687.1 Fibrobacter intestinalis:0.65866,314063 CP001146.1 Dictyoglomus thermophilum:0.38791):0.32147,276579 EU652053.1 Thermus scotoductus:0.57336);&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_tree</span><span class="o">=</span><span class="n">make_tree</span><span class="p">(</span><span class="n">simple_tree_string</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">complex_tree</span><span class="o">=</span><span class="n">DndParser</span><span class="p">(</span><span class="n">complex_tree_string</span><span class="p">,</span> <span class="n">PhyloNode</span><span class="p">)</span>
</pre></div>
</div>
<p>Now to displaying, creating, deleting, and inserting a node in simple_tree.  Note that simple_tree has three tips, one internal node ‘E’, and the root ‘F.’  For this example, we will create a node named ‘A’, with a distance of 0.1, delete the node ‘C’ through its parent, the internal node ‘E’, and finally we will insert ‘A’ where ‘C’ once was.</p>
<p>Display the original tree.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">simple_tree</span><span class="o">.</span><span class="n">ascii_art</span><span class="p">())</span>
<span class="go">          /-B</span>
<span class="go">-F-------|</span>
<span class="go">         |          /-C</span>
<span class="go">          \E-------|</span>
<span class="go">                    \-D</span>
</pre></div>
</div>
<p>Create a new node object.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">A_node</span><span class="o">=</span><span class="n">PhyloNode</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">Length</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p>Display the children of the root node, one of which is the parent of the tip we wish to alter.  To add or remove a node, we need to use the parent of the target node, which in this case is the internal node ‘E.’</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">simple_tree</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
<span class="go">[Tree(&quot;B;&quot;), Tree(&quot;(C,D)E;&quot;)]</span>
</pre></div>
</div>
<p>Remove the ‘C’ tip.  <strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">remove()</span></code> and <code class="docutils literal notranslate"><span class="pre">remove_node()</span></code> return ‘True’ if a node is removed, ‘False’ if they cannot remove a node.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Insert the new ‘A’ tip where ‘C’ was previously.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">A_node</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, display the modified tree.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">simple_tree</span><span class="o">.</span><span class="n">ascii_art</span><span class="p">())</span>
<span class="go">          /-B</span>
<span class="go">-F-------|</span>
<span class="go">         |          /-A</span>
<span class="go">          \E-------|</span>
<span class="go">                    \-D</span>
</pre></div>
</div>
<p>When deleting tree nodes, it is often desirable to clean up any unbranched internal nodes that may have resulted from removal of tips.  For example, if we wanted to delete the node ‘A’ that was previously added, the resulting tree would have an unbranched internal node ‘E.’</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">simple_tree</span><span class="o">.</span><span class="n">ascii_art</span><span class="p">())</span>
<span class="go">          /-B</span>
<span class="go">-F-------|</span>
<span class="go">          \E------- /-D</span>
</pre></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">prune()</span></code> method, internal nodes with only a single branch are removed.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_tree</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">simple_tree</span><span class="o">.</span><span class="n">ascii_art</span><span class="p">())</span>
<span class="go">          /-B</span>
<span class="go">-F-------|</span>
<span class="go">          \-D</span>
</pre></div>
</div>
</div>
<div class="section" id="an-example-of-conditional-tree-node-modifications">
<h1>An Example of Conditional Tree Node Modifications<a class="headerlink" href="#an-example-of-conditional-tree-node-modifications" title="Permalink to this headline">¶</a></h1>
<p>Now to look at the more complex and realistic tree.  In complex_tree, there are no internal nodes or a defined root.  In order to display this tree in a more succinct manner, we can rename these tips to only contain the genus and species names.  To step through the tips only, we can use the <code class="docutils literal notranslate"><span class="pre">iter_tips()</span></code> iterator, and rename each node.  The <code class="docutils literal notranslate"><span class="pre">ascii_art()</span></code> function, by default, will attempt to display internal nodes; this can be suppressed by the parameter <code class="docutils literal notranslate"><span class="pre">show_internal=False</span></code>.</p>
<p>First, let’s split the ungainly name string for each tip and only preserve the genus and species component, separated by a space.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">complex_tree</span><span class="o">.</span><span class="n">iter_tips</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<p>Now we display the tree with <code class="docutils literal notranslate"><span class="pre">ascii_art()</span></code>.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">complex_tree</span><span class="o">.</span><span class="n">ascii_art</span><span class="p">(</span><span class="n">show_internal</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="go">                              /-Alkalibacterium putridalgicola</span>
<span class="go">                    /--------|</span>
<span class="go">                   |          \-Marinilactibacillus psychrotolerans</span>
<span class="go">          /--------|</span>
<span class="go">         |         |          /-Facklamia hominis</span>
<span class="go">         |         |         |</span>
<span class="go">         |          \--------|          /-Aerococcus viridans</span>
<span class="go">         |                   |         |</span>
<span class="go">         |                    \--------|                    /-Abiotrophia defectiva</span>
<span class="go">         |                             |          /--------|</span>
<span class="go">---------|                              \--------|          \-Bacillus schlegelii</span>
<span class="go">         |                                       |</span>
<span class="go">         |                                        \-Fibrobacter succinogenes</span>
<span class="go">         |</span>
<span class="go">         |          /-Fibrobacter intestinalis</span>
<span class="go">         |---------|</span>
<span class="go">         |          \-Dictyoglomus thermophilum</span>
<span class="go">         |</span>
<span class="go">          \-Thermus scotoductus</span>
</pre></div>
</div>
<p>For another example of manipulating a phylogenetic tree, let us suppose that we want to remove any species in the tree that are not closely related to <em>Aerococcus viridans</em>.  To do this, we will delete any nodes that have a greater phylogenetic distance than 1.8 from <em>Aerococcus viridans</em>.  The best method to remove a large number of nodes from a tree is to first create a list of nodes to delete, followed by the actual removal process.  It is important that the <code class="docutils literal notranslate"><span class="pre">prune()</span></code> function be called after deletion of each node to ensure that internal nodes whose tips are deleted are removed instead of becoming tips.  Alternatively, one could test for internal nodes whose children are deleted in the procedure and flag these nodes to be deleted as well.</p>
<p>First, generate a list of tip nodes.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tips</span><span class="o">=</span><span class="n">complex_tree</span><span class="o">.</span><span class="n">tips</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, iterate through this list, compare the distances to <em>Aerococcus</em>, and append to the deletion list if greater than 1.8.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tips_to_delete</span><span class="o">=</span><span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AEROCOCCUS_INDEX</span><span class="o">=</span><span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tips</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">tips</span><span class="p">[</span><span class="n">AEROCOCCUS_INDEX</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.8</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">tips_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Now for the actual deletion process.  We can simply use the parent of each node in the deletion list to remove itself.  Pruning is necessary to prevent internal nodes from being left as tips.  <strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">remove()</span></code> and <code class="docutils literal notranslate"><span class="pre">remove_node()</span></code> return ‘True’ if a node is successfully removed, ‘False’ otherwise.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tips_to_delete</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">n</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">complex_tree</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
<span class="go">True</span>
<span class="go">True</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Finally, print the modified <code class="docutils literal notranslate"><span class="pre">complex_tree</span></code>.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">complex_tree</span><span class="o">.</span><span class="n">ascii_art</span><span class="p">(</span><span class="n">show_internal</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="go">                              /-Alkalibacterium putridalgicola</span>
<span class="go">                    /--------|</span>
<span class="go">                   |          \-Marinilactibacillus psychrotolerans</span>
<span class="go">--------- /--------|</span>
<span class="go">                   |          /-Facklamia hominis</span>
<span class="go">                   |         |</span>
<span class="go">                    \--------|          /-Aerococcus viridans</span>
<span class="go">                             |         |</span>
<span class="go">                              \--------|                    /-Abiotrophia defectiva</span>
<span class="go">                                       |          /--------|</span>
<span class="go">                                        \--------|          \-Bacillus schlegelii</span>
<span class="go">                                                 |</span>
<span class="go">                                                  \-Fibrobacter succinogenes</span>
</pre></div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, cogent3 Team.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>